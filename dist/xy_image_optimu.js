for(var oHead=document.getElementsByTagName("head")[0],includeFile=["megapix-image.js","hammer.min.js","iscroll-zoom-min.js","lrz.all.bundle.js","PhotoClip.js"],i=0;i<includeFile.length;i++){var oScript=document.createElement("script");oScript.setAttribute("type","text/javascript"),oScript.setAttribute("src","js/"+includeFile[i]),oHead.appendChild(oScript)}function picProcessing(e){console.log(e),this.id=e.id,this.callback=e.fun,null!=e.isClip&&""!=e.isClip?(this.setting=e.isClip,this.clip(this.setting)):this.picCompress()}window.onerror=function(e,i,t,s,a){alert("程序加载出错，请尝试重新刷新页面！")},picProcessing.prototype.picCompress=function(){var _this=this;document.getElementById(this.id).onchange=function(){var file=this.files[0],fileReader=new FileReader;fileReader.readAsDataURL(file);var userWidth=document.body.offsetWidth,userHeight=document.body.offsetHeight;fileReader.onload=function(){var IMG=new Image;IMG.src=this.result,IMG.onload=function(){var w=this.width,h=this.height,resizeW=0,resizeH=0,maxSize={width:userWidth,height:userHeight,level:.8};if(!(w>maxSize.width||h>maxSize.height))return eval(_this.callback+"(IMG.src)"),!1;resizeW=userWidth,resizeH=userHeight;var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");if(0<window.navigator.userAgent.indexOf("iPhone")){var mpImg=new MegaPixImage(file),resultImage=document.createElement("img");resultImage.id="resultImage";var resImg=document.getElementById("resultImage");return mpImg.render(resImg,{maxWidth:300,maxHeight:300,orientation:6,quality:1}),setTimeout(function(){var ios64=resImg.src;eval(_this.callback+"(ios64)")},1e3),!1}canvas.width=resizeW,canvas.height=resizeH,ctx.drawImage(IMG,0,0,resizeW,resizeH);var base64=canvas.toDataURL(file.type,maxSize.level);eval(_this.callback+"(base64)")}}}},picProcessing.prototype.clip=function(setting){var _this=this,pc=new PhotoClip(setting.container,{size:setting.options.size,outputSize:setting.options.outputSize,file:"#"+this.id,view:setting.options.res,ok:setting.options.clip,loadStart:function(){console.log("Load Img")},loadComplete:function(){console.log("Img Onload")},done:function(dataURL){eval(_this.callback+"(dataURL)")},fail:function(e){alert(e)}})};